"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[777],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>f});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),s=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=s(e.components);return r.createElement(c.Provider,{value:n},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,c=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=s(t),d=a,f=m["".concat(c,".").concat(d)]||m[d]||p[d]||l;return t?r.createElement(f,i(i({ref:n},u),{},{components:t})):r.createElement(f,i({ref:n},u))}));function f(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,i=new Array(l);i[0]=d;var o={};for(var c in n)hasOwnProperty.call(n,c)&&(o[c]=n[c]);o.originalType=e,o[m]="string"==typeof e?e:a,i[1]=o;for(var s=2;s<l;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},3901:(e,n,t)=>{t.d(n,{Z:()=>i});var r=t(7294),a=t(3743);const l={tableOfContentsInline:"tableOfContentsInline_prmo"};function i(e){let{toc:n,minHeadingLevel:t,maxHeadingLevel:i}=e;return r.createElement("div",{className:l.tableOfContentsInline},r.createElement(a.Z,{toc:n,minHeadingLevel:t,maxHeadingLevel:i,className:"table-of-contents",linkClassName:null}))}},3743:(e,n,t)=>{t.d(n,{Z:()=>f});var r=t(7462),a=t(7294),l=t(6668);function i(e){const n=e.map((e=>({...e,parentIndex:-1,children:[]}))),t=Array(7).fill(-1);n.forEach(((e,n)=>{const r=t.slice(2,e.level);e.parentIndex=Math.max(...r),t[e.level]=n}));const r=[];return n.forEach((e=>{const{parentIndex:t,...a}=e;t>=0?n[t].children.push(a):r.push(a)})),r}function o(e){let{toc:n,minHeadingLevel:t,maxHeadingLevel:r}=e;return n.flatMap((e=>{const n=o({toc:e.children,minHeadingLevel:t,maxHeadingLevel:r});return function(e){return e.level>=t&&e.level<=r}(e)?[{...e,children:n}]:n}))}function c(e){const n=e.getBoundingClientRect();return n.top===n.bottom?c(e.parentNode):n}function s(e,n){let{anchorTopOffset:t}=n;const r=e.find((e=>c(e).top>=t));if(r){return function(e){return e.top>0&&e.bottom<window.innerHeight/2}(c(r))?r:e[e.indexOf(r)-1]??null}return e[e.length-1]??null}function u(){const e=(0,a.useRef)(0),{navbar:{hideOnScroll:n}}=(0,l.L)();return(0,a.useEffect)((()=>{e.current=n?0:document.querySelector(".navbar").clientHeight}),[n]),e}function m(e){const n=(0,a.useRef)(void 0),t=u();(0,a.useEffect)((()=>{if(!e)return()=>{};const{linkClassName:r,linkActiveClassName:a,minHeadingLevel:l,maxHeadingLevel:i}=e;function o(){const e=function(e){return Array.from(document.getElementsByClassName(e))}(r),o=function(e){let{minHeadingLevel:n,maxHeadingLevel:t}=e;const r=[];for(let a=n;a<=t;a+=1)r.push(`h${a}.anchor`);return Array.from(document.querySelectorAll(r.join()))}({minHeadingLevel:l,maxHeadingLevel:i}),c=s(o,{anchorTopOffset:t.current}),u=e.find((e=>c&&c.id===function(e){return decodeURIComponent(e.href.substring(e.href.indexOf("#")+1))}(e)));e.forEach((e=>{!function(e,t){t?(n.current&&n.current!==e&&n.current.classList.remove(a),e.classList.add(a),n.current=e):e.classList.remove(a)}(e,e===u)}))}return document.addEventListener("scroll",o),document.addEventListener("resize",o),o(),()=>{document.removeEventListener("scroll",o),document.removeEventListener("resize",o)}}),[e,t])}function p(e){let{toc:n,className:t,linkClassName:r,isChild:l}=e;return n.length?a.createElement("ul",{className:l?void 0:t},n.map((e=>a.createElement("li",{key:e.id},a.createElement("a",{href:`#${e.id}`,className:r??void 0,dangerouslySetInnerHTML:{__html:e.value}}),a.createElement(p,{isChild:!0,toc:e.children,className:t,linkClassName:r}))))):null}const d=a.memo(p);function f(e){let{toc:n,className:t="table-of-contents table-of-contents__left-border",linkClassName:c="table-of-contents__link",linkActiveClassName:s,minHeadingLevel:u,maxHeadingLevel:p,...f}=e;const v=(0,l.L)(),g=u??v.tableOfContents.minHeadingLevel,E=p??v.tableOfContents.maxHeadingLevel,k=function(e){let{toc:n,minHeadingLevel:t,maxHeadingLevel:r}=e;return(0,a.useMemo)((()=>o({toc:i(n),minHeadingLevel:t,maxHeadingLevel:r})),[n,t,r])}({toc:n,minHeadingLevel:g,maxHeadingLevel:E});return m((0,a.useMemo)((()=>{if(c&&s)return{linkClassName:c,linkActiveClassName:s,minHeadingLevel:g,maxHeadingLevel:E}}),[c,s,g,E])),a.createElement(d,(0,r.Z)({toc:k,className:t,linkClassName:c},f))}},6356:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>c,toc:()=>u});var r=t(7462),a=(t(7294),t(3905)),l=t(3901);const i={id:"\u81ea\u52a8\u5316",title:"\u81ea\u52a8\u5316",tags:["\u81ea\u52a8\u5316"]},o=void 0,c={unversionedId:"\u540e\u7aef/\u81ea\u52a8\u5316",id:"\u540e\u7aef/\u81ea\u52a8\u5316",title:"\u81ea\u52a8\u5316",description:"<TOCInline",source:"@site/docs/\u540e\u7aef/\u81ea\u52a8\u5316.md",sourceDirName:"\u540e\u7aef",slug:"/\u540e\u7aef/\u81ea\u52a8\u5316",permalink:"/what_i_konw/\u540e\u7aef/\u81ea\u52a8\u5316",draft:!1,tags:[{label:"\u81ea\u52a8\u5316",permalink:"/what_i_konw/tags/\u81ea\u52a8\u5316"}],version:"current",frontMatter:{id:"\u81ea\u52a8\u5316",title:"\u81ea\u52a8\u5316",tags:["\u81ea\u52a8\u5316"]},sidebar:"tutorialSidebar",previous:{title:"\u6570\u636e\u5e93",permalink:"/what_i_konw/\u540e\u7aef/\u6570\u636e\u5e93"}},s={},u=[{value:"\u90e8\u7f72",id:"\u90e8\u7f72",level:3}],m={toc:u},p="wrapper";function d(e){let{components:n,...t}=e;return(0,a.kt)(p,(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)(l.Z,{toc:u.filter((e=>2===e.level)),minHeadingLevel:2,maxHeadingLevel:2,mdxType:"TOCInline"}),(0,a.kt)("h3",{id:"\u90e8\u7f72"},"\u90e8\u7f72"),(0,a.kt)("p",null,".gitlab-ci.yml \u548c.env \u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b"),(0,a.kt)("p",null,".gitlab-ci.yml"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'stages:\n  - build\n  - deploy\n\nbefore_script:\n  - source .env\n\nbuild_image:\n  stage: build\n  script:\n    - yarn install\n    - yarn build\n    - docker build -t $IMAGE_NAME .\n    - docker push $IMAGE_NAME\n\ndeploy_to_remote:\n  stage: deploy\n  script:\n    - echo "$SSH_PRIVATE_KEY" | tr -d \'\\r\' > ~/.ssh/id_rsa\n    - chmod 600 ~/.ssh/id_rsa\n    - ssh $REMOTE_USER@$REMOTE_HOST "docker pull $IMAGE_NAME"\n    - ssh $REMOTE_USER@$REMOTE_HOST "docker stop $OLD_APP_CONTAINER || true"\n    - ssh $REMOTE_USER@$REMOTE_HOST "docker rm $OLD_APP_CONTAINER || true"\n    - ssh $REMOTE_USER@$REMOTE_HOST "docker run -d --name $NEW_APP_CONTAINER -p 80:80 -p 433:433 $IMAGE_NAME"\n')),(0,a.kt)("p",null,".env"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-.env"},"export IMAGE_NAME=your-docker-image-name\nexport REMOTE_HOST=119.23.252.104\nexport REMOTE_USER=root\nexport OLD_APP_CONTAINER=old-app-container\nexport NEW_APP_CONTAINER=new-app-container\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5982\u4f55\u5728 GitLab CI/CD \u8bbe\u7f6e\u4e2d\u6dfb\u52a0\u90e8\u7f72\u5bc6\u94a5\u5462\uff1f")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"1.\u672c\u5730\u673a\u5668\u751f\u6210 SSH \u5bc6\u94a5\uff1a")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'ssh-keygen -t rsa -b 4096 -C "your_email@example.com"\n')),(0,a.kt)("p",null,"\u6309\u7167\u63d0\u793a\u8f93\u5165\u6587\u4ef6\u540d\u548c\u5bc6\u7801\uff0c\u6216\u8005\u76f4\u63a5\u6309 Enter \u952e\u4f7f\u7528\u9ed8\u8ba4\u8bbe\u7f6e\u3002\u8fd9\u5c06\u5728",(0,a.kt)("inlineCode",{parentName:"p"},"~/.ssh/"),"\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u5bf9 SSH \u5bc6\u94a5\u6587\u4ef6\uff08",(0,a.kt)("inlineCode",{parentName:"p"},"id_rsa")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"id_rsa.pub"),"\uff09\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2.\u6dfb\u52a0 SSH \u516c\u94a5\u5230\u8fdc\u7a0b\u4e3b\u673a\uff1a")),(0,a.kt)("p",null,"\u5c06\u751f\u6210\u7684 SSH \u516c\u94a5\uff08",(0,a.kt)("inlineCode",{parentName:"p"},"id_rsa.pub"),"\u6587\u4ef6\u7684\u5185\u5bb9\uff09\u6dfb\u52a0\u5230\u8fdc\u7a0b\u4e3b\u673a\u7684",(0,a.kt)("inlineCode",{parentName:"p"},"~/.ssh/authorized_keys"),"\u6587\u4ef6\u4e2d\u3002\u8fd9\u5141\u8bb8 GitLab CI/CD \u901a\u8fc7 SSH \u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"3.\u6dfb\u52a0 SSH \u79c1\u94a5\u5230 GitLab CI/CD \u9879\u76ee\u8bbe\u7f6e\u4e2d\uff1a")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u767b\u5f55\u5230\u4f60\u7684 GitLab \u9879\u76ee\u3002"),(0,a.kt)("li",{parentName:"ul"},'\u8f6c\u5230\u9879\u76ee\u4eea\u8868\u677f\u5e76\u9009\u62e9 "Settings" > "CI / CD"\u3002'),(0,a.kt)("li",{parentName:"ul"},'\u5728 "Variables" \u90e8\u5206\uff0c\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u53d8\u91cf\uff0c\u8bbe\u7f6e\u53d8\u91cf\u540d\u4e3a',(0,a.kt)("inlineCode",{parentName:"li"},"SSH_PRIVATE_KEY"),"\uff0c\u5e76\u5c06\u5176\u503c\u8bbe\u7f6e\u4e3a\u4f60\u751f\u6210\u7684 SSH \u79c1\u94a5\u7684\u5185\u5bb9\u3002\u786e\u4fdd\u8fd9\u4e2a\u79c1\u94a5\u662f\u6ca1\u6709\u5bc6\u7801\u7684\uff0c\u4ee5\u4fbf\u81ea\u52a8\u5316\u6d41\u7a0b\u53ef\u4ee5\u4f7f\u7528\u5b83\u3002")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"4.\u5728 CI/CD \u811a\u672c\u4e2d\u4f7f\u7528 SSH \u79c1\u94a5")))}d.isMDXComponent=!0}}]);